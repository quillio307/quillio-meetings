{% extends"helpers/dashboard.html" %} {% block title %}Meeting In Progress{% endblock %}

{% block main %}
<div class="jumbotron">
    <h1 class="h1-responsive">{{meeting.title}}</h1>
    <button type="button" class="btn btn-success" id="start">Start</button>
    <button type="button" class="btn btn-danger" id="end">End</button>

    <ul id="msgboard"></ul>
    <br>
    <a class="btn-floating btn-lg pkColor" id="mic" style="background:gray;">
        <i class="fa fa-microphone fa-5x"></i>
    </a>
     <audio id="player" controls></audio>
    <script>
      var player = document.getElementById('player');

      /*var handleSuccess = function(stream) {
        if (window.URL) {
          player.src = window.URL.createObjectURL(stream);
        } else {
          player.src = stream;
        }
      };*/
      var handleSuccess = function(stream) {
        var context = new AudioContext();
        var input = context.createMediaStreamSource(stream)
        var processor = context.createScriptProcessor(1024,1,1);

        input.connect(processor);
        processor.connect(context.destination);

        processor.onaudioprocess = function(e){
          // Do something with the data, i.e Convert this to WAV
          //console.log(e.inputBuffer);
        };
      };

  navigator.mediaDevices.getUserMedia({ audio: true, video: false })
      .then(handleSuccess);

    </script>
</div>

<a class="btn-floating btn-lg pkColor" style="position: fixed; right:35px; bottom:35px;" data-toggle="modal" data-target="#createMeetingForm"><i class="fa fa-plus"></i></a>

<!--Modal: Contact form-->
<div class="modal fade" id="createMeetingForm" tabindex="-1" role="dialog" aria-labelledby="createMeetingForm" aria-hidden="true">
    <div class="modal-dialog cascading-modal" role="document">
        <!--Content-->
        <div class="modal-content">
            <!--Header-->
            <div class="modal-header darken-3 white-text" style="background-color: #45526E">
                <h4 class=" title"><i class="fa fa-pencil"></i>Create Meeting</h4>
                <button type="button" class="close waves-effect waves-light" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
            </div>
            <!--Body-->
            <form>
                <div class="modal-body mb-0">
                    <div class="md-form form-sm">
                        <input type="text" id="name" name="name" value="{{ request.form.name }}" class="form-control" required>
                        <label for="name"> Meeting Name </label>
                    </div>

                    <div class="md-form form-sm">
                        <input type="text" id="emails" name="emails" value="{{ request.form.emails }}" class="form-control" required>
                        <label for="emails"> Member Emails </label>
                    </div>

                    <div class="text-center mt-1-half">
                        <button id="meetingCreateButton" type="submit" name="submit" class="btn btn-mdb mdb-2" value="create" formmethod="post"> Create <i class="fa fa-send ml-1"></i></button>
                    </div>
                </div>
            </form>
        </div>
        <!--/.Content-->
    </div>
</div>

{% endblock %}

{% block js_import %}
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
<script type="text/javascript" src="/static/main.js"></script>
{% endblock %}